<!DOCTYPE html><html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Turbocall: the Just-in-time compiler for Deno FFI</title>
<!--Generated on Sun Jun  9 15:20:44 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<!--Document created on March 25, 2024.-->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/dginev/ar5iv-css@0.7.9/css/ar5iv.min.css" type="text/css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/dginev/ar5iv-css@0.7.9/css/ar5iv-fonts.min.css" type="text/css">
</head>
<body>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Turbocall: the Just-in-time compiler for Deno FFI</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
Divy Srivastava<sup id="id3.3.id1" class="ltx_sup"><span id="id3.3.id1.1" class="ltx_text ltx_font_italic">1</span></sup>

<br class="ltx_break"><sup id="id4.4.id2" class="ltx_sup"><span id="id4.4.id2.1" class="ltx_text ltx_font_italic">1</span></sup>divy@deno.land
</span></span>
</div>
<div class="ltx_dates">(March 25, 2024)</div>

<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p id="id5.id1" class="ltx_p">In this post, we will explore the lesser known optimization in Deno that makes FFI fast.</p>
</div>
<section id="S1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>

<div id="S1.p1" class="ltx_para">
<p id="S1.p1.1" class="ltx_p">V8 Isolates are little sandboxes that run JS.
JavaScript runtimes give you the ability to call native functions by reaching out of this sandbox.
These native functions are often referred to as ”bindings”.</p>
</div>
<div id="S1.p2" class="ltx_para">
<p id="S1.p2.1" class="ltx_p">Optimizing these bindings are one of the most important optimizations in a JavaScript runtime.
Over the years, V8 has made significant improvements in this area to make bindings faster for embedders.</p>
</div>
<div id="S1.p3" class="ltx_para">
<p id="S1.p3.1" class="ltx_p">Let’s look at an example of a V8 C++ binding:</p>
</div>
<figure id="LST1" class="ltx_float ltx_lstlisting">
<div id="LST1.1" class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing" style="background-color:#FFFFFF;border-color: #000000;">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dm9pZCBBZGQoY29uc3QgRnVuY3Rpb25DYWxsYmFja0luZm88VmFsdWU+JiBhcmdzKSB7CiAgSXNvbGF0ZSogaXNvbGF0ZSA9IGFyZ3MuR2V0SXNvbGF0ZSgpOwogIC8vIENoZWNrIHRoZSBudW1iZXIgb2YgYXJndW1lbnRzIHBhc3NlZC4KICBpZiAoYXJncy5MZW5ndGgoKSA8IDIpIHsKICAgIGlzb2xhdGUtPlRocm93RXhjZXB0aW9uKEV4Y2VwdGlvbjo6VHlwZUVycm9yKAogICAgICAgIFN0cmluZzo6TmV3RnJvbVV0ZjgoaXNvbGF0ZSwgIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMiLCBOZXdTdHJpbmdUeXBlOjprTm9ybWFsKS5Ub0xvY2FsQ2hlY2tlZCgpKSk7CiAgICByZXR1cm47CiAgfQogIC8vIENoZWNrIHRoZSBhcmd1bWVudCB0eXBlcwogIGlmICghYXJnc1swXS0+SXNOdW1iZXIoKSB8fCAhYXJnc1sxXS0+SXNOdW1iZXIoKSkgewogICAgaXNvbGF0ZS0+VGhyb3dFeGNlcHRpb24oRXhjZXB0aW9uOjpUeXBlRXJyb3IoCiAgICAgICAgU3RyaW5nOjpOZXdGcm9tVXRmOChpc29sYXRlLCAiV3JvbmcgYXJndW1lbnRzIiwgTmV3U3RyaW5nVHlwZTo6a05vcm1hbCkuVG9Mb2NhbENoZWNrZWQoKSkpOwogICAgcmV0dXJuOwogIH0KICAvLyBDb252ZXJ0IHRoZSBhcmd1bWVudHMgdG8gbnVtYmVycy4KICBkb3VibGUgdmFsdWUgPSBhcmdzWzBdLT5OdW1iZXJWYWx1ZShpc29sYXRlKSArIGFyZ3NbMV0tPk51bWJlclZhbHVlKGlzb2xhdGUpOwogIC8vIENyZWF0ZSBhIG5ldyBOdW1iZXIgdmFsdWUgYW5kIHNldCBpdCBhcyB0aGUgcmV0dXJuIHZhbHVlLgogIExvY2FsPE51bWJlcj4gbnVtID0gTnVtYmVyOjpOZXcoaXNvbGF0ZSwgdmFsdWUpOwogIGFyZ3MuR2V0UmV0dXJuVmFsdWUoKS5TZXQobnVtKTsKfQ==" download="">⬇</a></div>
<div id="lstnumberx1" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span id="lstnumberx1.1" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx1.1.1" class="ltx_text" style="color:#0000FF;">void</span></span><span id="lstnumberx1.2" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx1.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Add</span><span id="lstnumberx1.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx1.5" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx1.5.1" class="ltx_text" style="color:#0000FF;">const</span></span><span id="lstnumberx1.6" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx1.7" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FunctionCallbackInfo</span><span id="lstnumberx1.8" class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span id="lstnumberx1.9" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Value</span><span id="lstnumberx1.10" class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&amp;</span><span id="lstnumberx1.11" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx1.12" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">args</span><span id="lstnumberx1.13" class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span id="lstnumberx1.14" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx1.15" class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx2" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span id="lstnumberx2.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx2.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Isolate</span><span id="lstnumberx2.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span id="lstnumberx2.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx2.5" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isolate</span><span id="lstnumberx2.6" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx2.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span id="lstnumberx2.8" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx2.9" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">args</span><span id="lstnumberx2.10" class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span id="lstnumberx2.11" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">GetIsolate</span><span id="lstnumberx2.12" class="ltx_text ltx_font_typewriter" style="font-size:90%;">();</span>
</div>
<div id="lstnumberx3" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span id="lstnumberx3.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx3.2" class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx3.2.1" class="ltx_text" style="color:#808080;">//<span id="lstnumberx3.2.1.1" class="ltx_text ltx_lst_space"> </span>Check<span id="lstnumberx3.2.1.2" class="ltx_text ltx_lst_space"> </span>the<span id="lstnumberx3.2.1.3" class="ltx_text ltx_lst_space"> </span>number<span id="lstnumberx3.2.1.4" class="ltx_text ltx_lst_space"> </span>of<span id="lstnumberx3.2.1.5" class="ltx_text ltx_lst_space"> </span>arguments<span id="lstnumberx3.2.1.6" class="ltx_text ltx_lst_space"> </span>passed.</span></span>
</div>
<div id="lstnumberx4" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span id="lstnumberx4.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx4.2" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx4.2.1" class="ltx_text" style="color:#0000FF;">if</span></span><span id="lstnumberx4.3" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx4.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx4.5" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">args</span><span id="lstnumberx4.6" class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span id="lstnumberx4.7" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Length</span><span id="lstnumberx4.8" class="ltx_text ltx_font_typewriter" style="font-size:90%;">()</span><span id="lstnumberx4.9" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx4.10" class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span id="lstnumberx4.11" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx4.12" class="ltx_text ltx_font_typewriter" style="font-size:90%;">2)</span><span id="lstnumberx4.13" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx4.14" class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx5" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span id="lstnumberx5.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span id="lstnumberx5.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isolate</span><span id="lstnumberx5.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span id="lstnumberx5.4" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ThrowException</span><span id="lstnumberx5.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx5.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Exception</span><span id="lstnumberx5.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span id="lstnumberx5.8" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">TypeError</span><span id="lstnumberx5.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span>
</div>
<div id="lstnumberx6" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span id="lstnumberx6.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span id="lstnumberx6.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">String</span><span id="lstnumberx6.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span id="lstnumberx6.4" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">NewFromUtf8</span><span id="lstnumberx6.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx6.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isolate</span><span id="lstnumberx6.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx6.8" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx6.9" class="ltx_text ltx_lst_string ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx6.9.1" class="ltx_text" style="color:#9400D1;">"Wrong<span id="lstnumberx6.9.1.1" class="ltx_text ltx_lst_space"> </span>number<span id="lstnumberx6.9.1.2" class="ltx_text ltx_lst_space"> </span>of<span id="lstnumberx6.9.1.3" class="ltx_text ltx_lst_space"> </span>arguments"</span></span><span id="lstnumberx6.10" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx6.11" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx6.12" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">NewStringType</span><span id="lstnumberx6.13" class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span id="lstnumberx6.14" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">kNormal</span><span id="lstnumberx6.15" class="ltx_text ltx_font_typewriter" style="font-size:90%;">).</span><span id="lstnumberx6.16" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ToLocalChecked</span><span id="lstnumberx6.17" class="ltx_text ltx_font_typewriter" style="font-size:90%;">()));</span>
</div>
<div id="lstnumberx7" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span id="lstnumberx7.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span id="lstnumberx7.2" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx7.2.1" class="ltx_text" style="color:#0000FF;">return</span></span><span id="lstnumberx7.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx8" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span id="lstnumberx8.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx8.2" class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx9" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span id="lstnumberx9.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx9.2" class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx9.2.1" class="ltx_text" style="color:#808080;">//<span id="lstnumberx9.2.1.1" class="ltx_text ltx_lst_space"> </span>Check<span id="lstnumberx9.2.1.2" class="ltx_text ltx_lst_space"> </span>the<span id="lstnumberx9.2.1.3" class="ltx_text ltx_lst_space"> </span>argument<span id="lstnumberx9.2.1.4" class="ltx_text ltx_lst_space"> </span>types</span></span>
</div>
<div id="lstnumberx10" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span id="lstnumberx10.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx10.2" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx10.2.1" class="ltx_text" style="color:#0000FF;">if</span></span><span id="lstnumberx10.3" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx10.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(!</span><span id="lstnumberx10.5" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">args</span><span id="lstnumberx10.6" class="ltx_text ltx_font_typewriter" style="font-size:90%;">[0]-&gt;</span><span id="lstnumberx10.7" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">IsNumber</span><span id="lstnumberx10.8" class="ltx_text ltx_font_typewriter" style="font-size:90%;">()</span><span id="lstnumberx10.9" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx10.10" class="ltx_text ltx_font_typewriter" style="font-size:90%;">||</span><span id="lstnumberx10.11" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx10.12" class="ltx_text ltx_font_typewriter" style="font-size:90%;">!</span><span id="lstnumberx10.13" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">args</span><span id="lstnumberx10.14" class="ltx_text ltx_font_typewriter" style="font-size:90%;">[1]-&gt;</span><span id="lstnumberx10.15" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">IsNumber</span><span id="lstnumberx10.16" class="ltx_text ltx_font_typewriter" style="font-size:90%;">())</span><span id="lstnumberx10.17" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx10.18" class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx11" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span id="lstnumberx11.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span id="lstnumberx11.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isolate</span><span id="lstnumberx11.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span id="lstnumberx11.4" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ThrowException</span><span id="lstnumberx11.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx11.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Exception</span><span id="lstnumberx11.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span id="lstnumberx11.8" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">TypeError</span><span id="lstnumberx11.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span>
</div>
<div id="lstnumberx12" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span id="lstnumberx12.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span id="lstnumberx12.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">String</span><span id="lstnumberx12.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span id="lstnumberx12.4" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">NewFromUtf8</span><span id="lstnumberx12.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx12.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isolate</span><span id="lstnumberx12.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx12.8" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx12.9" class="ltx_text ltx_lst_string ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx12.9.1" class="ltx_text" style="color:#9400D1;">"Wrong<span id="lstnumberx12.9.1.1" class="ltx_text ltx_lst_space"> </span>arguments"</span></span><span id="lstnumberx12.10" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx12.11" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx12.12" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">NewStringType</span><span id="lstnumberx12.13" class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span id="lstnumberx12.14" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">kNormal</span><span id="lstnumberx12.15" class="ltx_text ltx_font_typewriter" style="font-size:90%;">).</span><span id="lstnumberx12.16" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ToLocalChecked</span><span id="lstnumberx12.17" class="ltx_text ltx_font_typewriter" style="font-size:90%;">()));</span>
</div>
<div id="lstnumberx13" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span id="lstnumberx13.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span id="lstnumberx13.2" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx13.2.1" class="ltx_text" style="color:#0000FF;">return</span></span><span id="lstnumberx13.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx14" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span id="lstnumberx14.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx14.2" class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx15" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span id="lstnumberx15.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx15.2" class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx15.2.1" class="ltx_text" style="color:#808080;">//<span id="lstnumberx15.2.1.1" class="ltx_text ltx_lst_space"> </span>Convert<span id="lstnumberx15.2.1.2" class="ltx_text ltx_lst_space"> </span>the<span id="lstnumberx15.2.1.3" class="ltx_text ltx_lst_space"> </span>arguments<span id="lstnumberx15.2.1.4" class="ltx_text ltx_lst_space"> </span>to<span id="lstnumberx15.2.1.5" class="ltx_text ltx_lst_space"> </span>numbers.</span></span>
</div>
<div id="lstnumberx16" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span><span id="lstnumberx16.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx16.2" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx16.2.1" class="ltx_text" style="color:#0000FF;">double</span></span><span id="lstnumberx16.3" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx16.4" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span id="lstnumberx16.5" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx16.6" class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span id="lstnumberx16.7" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx16.8" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">args</span><span id="lstnumberx16.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">[0]-&gt;</span><span id="lstnumberx16.10" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">NumberValue</span><span id="lstnumberx16.11" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx16.12" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isolate</span><span id="lstnumberx16.13" class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span id="lstnumberx16.14" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx16.15" class="ltx_text ltx_font_typewriter" style="font-size:90%;">+</span><span id="lstnumberx16.16" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx16.17" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">args</span><span id="lstnumberx16.18" class="ltx_text ltx_font_typewriter" style="font-size:90%;">[1]-&gt;</span><span id="lstnumberx16.19" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">NumberValue</span><span id="lstnumberx16.20" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx16.21" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isolate</span><span id="lstnumberx16.22" class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx17" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span><span id="lstnumberx17.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx17.2" class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx17.2.1" class="ltx_text" style="color:#808080;">//<span id="lstnumberx17.2.1.1" class="ltx_text ltx_lst_space"> </span>Create<span id="lstnumberx17.2.1.2" class="ltx_text ltx_lst_space"> </span>a<span id="lstnumberx17.2.1.3" class="ltx_text ltx_lst_space"> </span>new<span id="lstnumberx17.2.1.4" class="ltx_text ltx_lst_space"> </span>Number<span id="lstnumberx17.2.1.5" class="ltx_text ltx_lst_space"> </span>value<span id="lstnumberx17.2.1.6" class="ltx_text ltx_lst_space"> </span>and<span id="lstnumberx17.2.1.7" class="ltx_text ltx_lst_space"> </span>set<span id="lstnumberx17.2.1.8" class="ltx_text ltx_lst_space"> </span>it<span id="lstnumberx17.2.1.9" class="ltx_text ltx_lst_space"> </span>as<span id="lstnumberx17.2.1.10" class="ltx_text ltx_lst_space"> </span>the<span id="lstnumberx17.2.1.11" class="ltx_text ltx_lst_space"> </span>return<span id="lstnumberx17.2.1.12" class="ltx_text ltx_lst_space"> </span>value.</span></span>
</div>
<div id="lstnumberx18" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">18</span><span id="lstnumberx18.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx18.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Local</span><span id="lstnumberx18.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span id="lstnumberx18.4" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Number</span><span id="lstnumberx18.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span id="lstnumberx18.6" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx18.7" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">num</span><span id="lstnumberx18.8" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx18.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span id="lstnumberx18.10" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx18.11" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Number</span><span id="lstnumberx18.12" class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span id="lstnumberx18.13" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">New</span><span id="lstnumberx18.14" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx18.15" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isolate</span><span id="lstnumberx18.16" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx18.17" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx18.18" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span id="lstnumberx18.19" class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx19" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">19</span><span id="lstnumberx19.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx19.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">args</span><span id="lstnumberx19.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span id="lstnumberx19.4" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">GetReturnValue</span><span id="lstnumberx19.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">().</span><span id="lstnumberx19.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Set</span><span id="lstnumberx19.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx19.8" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">num</span><span id="lstnumberx19.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx20" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">20</span><span id="lstnumberx20.1" class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
</div>
<figcaption class="ltx_caption" style="background-color:#FFFFFF;"><span class="ltx_tag ltx_tag_float">Listing 1: </span>example V8 C++ binding</figcaption>
</figure>
<div id="S1.p4" class="ltx_para">
<p id="S1.p4.1" class="ltx_p">This does a bunch of stuff, like checking the number of arguments, type checking, converting arguments and setting the return value. Moreover, V8 has to jump through (quite literally) a lot of hoops to make this work.
It sets up guards and jumps out of the optimized JIT code to the runtime.</p>
</div>
<div id="S1.p5" class="ltx_para">
<p id="S1.p5.1" class="ltx_p">What if there was a way to call bindings without moving out of the optimized JIT code and without all the type checks?</p>
</div>
</section>
<section id="S2" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>V8 Fast API Calls</h2>

<div id="S2.p1" class="ltx_para">
<p id="S2.p1.1" class="ltx_p">V8 Fast calls are a relatively new optimization in V8.</p>
</div>
<div id="S2.p2" class="ltx_para">
<p id="S2.p2.1" class="ltx_p">V8 can call our native binding directly from the optimized JIT code if
we provide it with the necessary type information. The necessary typechecks happen in the compiler itself including fallback to the slow path.</p>
</div>
<figure id="LST2" class="ltx_float ltx_lstlisting">
<div id="LST2.1" class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing" style="background-color:#FFFFFF;border-color: #000000;">
<div class="ltx_listing_data"><a href="data:text/plain;base64,aW50IEZhc3RBZGQoaW50IGEsIGludCBiKTsKCi8vIEV4dHJhY3RzIHR5cGUgaW5mb3JtYXRpb24gZnJvbSB0aGUgZnVuY3Rpb24gc2lnbmF0dXJlCnY4OjpDRnVuY3Rpb24gZmFzdF9hZGQgPSBNYWtlVjhDRnVuY3Rpb24oRmFzdEFkZCk7" download="">⬇</a></div>
<div id="lstnumberx21" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span id="lstnumberx21.1" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx21.1.1" class="ltx_text" style="color:#0000FF;">int</span></span><span id="lstnumberx21.2" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx21.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FastAdd</span><span id="lstnumberx21.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx21.5" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx21.5.1" class="ltx_text" style="color:#0000FF;">int</span></span><span id="lstnumberx21.6" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx21.7" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">a</span><span id="lstnumberx21.8" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx21.9" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx21.10" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx21.10.1" class="ltx_text" style="color:#0000FF;">int</span></span><span id="lstnumberx21.11" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx21.12" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">b</span><span id="lstnumberx21.13" class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx22" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span>
</div>
<div id="lstnumberx23" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span id="lstnumberx23.1" class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx23.1.1" class="ltx_text" style="color:#808080;">//<span id="lstnumberx23.1.1.1" class="ltx_text ltx_lst_space"> </span>Extracts<span id="lstnumberx23.1.1.2" class="ltx_text ltx_lst_space"> </span>type<span id="lstnumberx23.1.1.3" class="ltx_text ltx_lst_space"> </span>information<span id="lstnumberx23.1.1.4" class="ltx_text ltx_lst_space"> </span>from<span id="lstnumberx23.1.1.5" class="ltx_text ltx_lst_space"> </span>the<span id="lstnumberx23.1.1.6" class="ltx_text ltx_lst_space"> </span>function<span id="lstnumberx23.1.1.7" class="ltx_text ltx_lst_space"> </span>signature</span></span>
</div>
<div id="lstnumberx24" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span id="lstnumberx24.1" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">v8</span><span id="lstnumberx24.2" class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span id="lstnumberx24.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">CFunction</span><span id="lstnumberx24.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx24.5" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">fast_add</span><span id="lstnumberx24.6" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx24.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span id="lstnumberx24.8" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx24.9" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">MakeV8CFunction</span><span id="lstnumberx24.10" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx24.11" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FastAdd</span><span id="lstnumberx24.12" class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
</div>
<figcaption class="ltx_caption" style="background-color:#FFFFFF;"><span class="ltx_tag ltx_tag_float">Listing 2: </span>example V8 Fast API call</figcaption>
</figure>
<div id="S2.p3" class="ltx_para">
<p id="S2.p3.1" class="ltx_p">This results in massive speedups for repetitve native calls from optimized JavaScript.
The calls are inlined and theoretically as fast as calling a native function.</p>
</div>
<div id="S2.p4" class="ltx_para">
<p id="S2.p4.1" class="ltx_p">Apart from native runtime bindings, one of the most common places where this optimization is used is in FFI (Foreign Function Interface) calls.</p>
</div>
</section>
<section id="S3" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Enter Deno FFI</h2>

<figure id="LST3" class="ltx_float ltx_lstlisting">
<div id="LST3.1" class="ltx_listing ltx_lst_language_JavaScript ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing" style="background-color:#FFFFFF;border-color: #000000;">
<div class="ltx_listing_data"><a href="data:text/plain;base64,Y29uc3QgeyBzeW1ib2xzIH0gPSBEZW5vLmRsb3BlbigibGliYy42LnNvIiwgewogIG9wZW46IHsKICAgIHBhcmFtZXRlcnM6IFsiYnVmZmVyIiwgImkzMiJdLAogICAgcmVzdWx0OiAiaTMyIiwKICB9LAp9KTs=" download="">⬇</a></div>
<div id="lstnumberx25" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span id="lstnumberx25.1" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">const</span><span id="lstnumberx25.2" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx25.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span id="lstnumberx25.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx25.5" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">symbols</span><span id="lstnumberx25.6" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx25.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span><span id="lstnumberx25.8" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx25.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span id="lstnumberx25.10" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx25.11" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Deno</span><span id="lstnumberx25.12" class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span id="lstnumberx25.13" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">dlopen</span><span id="lstnumberx25.14" class="ltx_text ltx_font_typewriter" style="font-size:90%;">("</span><span id="lstnumberx25.15" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">libc</span><span id="lstnumberx25.16" class="ltx_text ltx_font_typewriter" style="font-size:90%;">.6.</span><span id="lstnumberx25.17" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">so</span><span id="lstnumberx25.18" class="ltx_text ltx_font_typewriter" style="font-size:90%;">",</span><span id="lstnumberx25.19" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx25.20" class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx26" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span id="lstnumberx26.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx26.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">open</span><span id="lstnumberx26.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span id="lstnumberx26.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx26.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx27" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span id="lstnumberx27.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span id="lstnumberx27.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">parameters</span><span id="lstnumberx27.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span id="lstnumberx27.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx27.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">["</span><span id="lstnumberx27.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">buffer</span><span id="lstnumberx27.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">",</span><span id="lstnumberx27.8" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx27.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">"</span><span id="lstnumberx27.10" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i32</span><span id="lstnumberx27.11" class="ltx_text ltx_font_typewriter" style="font-size:90%;">"],</span>
</div>
<div id="lstnumberx28" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span id="lstnumberx28.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span id="lstnumberx28.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">result</span><span id="lstnumberx28.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span id="lstnumberx28.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx28.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">"</span><span id="lstnumberx28.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i32</span><span id="lstnumberx28.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">",</span>
</div>
<div id="lstnumberx29" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span id="lstnumberx29.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx29.2" class="ltx_text ltx_font_typewriter" style="font-size:90%;">},</span>
</div>
<div id="lstnumberx30" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span id="lstnumberx30.1" class="ltx_text ltx_font_typewriter" style="font-size:90%;">});</span>
</div>
</div>
<figcaption class="ltx_caption" style="background-color:#FFFFFF;"><span class="ltx_tag ltx_tag_float">Listing 3: </span>example Deno FFI</figcaption>
</figure>
<div id="S3.p1" class="ltx_para">
<p id="S3.p1.1" class="ltx_p">‘Deno.dlopen‘ is the API to open a dynamic library. Notice anything familiar? We are defining the number of arguments, types and the return value.</p>
</div>
<div id="S3.p2" class="ltx_para">
<p id="S3.p2.1" class="ltx_p">We could use this information to generate optimized native binding and give it to V8!</p>
</div>
</section>
<section id="S4" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Turbocall: a JIT for JIT</h2>
<span id="footnote1" class="ltx_note ltx_role_footnote"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>https://github.com/denoland/deno/tree/ae52b49dd6edcfbb88ea39c3fcf0c0cc4b59eee7/ext/ffi</span></span></span>
<div id="S4.p1" class="ltx_para">
<p id="S4.p1.1" class="ltx_p">Deno created a tiny assembler (in Rust ofc) to generate optimized bindings for FFI calls based on the type information.</p>
</div>
<figure id="LST4" class="ltx_float ltx_lstlisting">
<div id="LST4.1" class="ltx_listing ltx_lst_language_JavaScript ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing" style="background-color:#FFFFFF;border-color: #000000;">
<div class="ltx_listing_data"><a href="data:text/plain;base64,RGVuby5kbG9wZW4oImxpYnRlc3Quc28iLCB7CiAgZnVuYzogewogICAgcGFyYW1ldGVyczogWyJidWZmZXIiLCAiaTMyIiwgImkzMiJdLAogICAgcmVzdWx0OiAiaTMyIiwKICB9LAp9KTs=" download="">⬇</a></div>
<div id="lstnumberx31" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span id="lstnumberx31.1" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Deno</span><span id="lstnumberx31.2" class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span id="lstnumberx31.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">dlopen</span><span id="lstnumberx31.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">("</span><span id="lstnumberx31.5" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">libtest</span><span id="lstnumberx31.6" class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span id="lstnumberx31.7" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">so</span><span id="lstnumberx31.8" class="ltx_text ltx_font_typewriter" style="font-size:90%;">",</span><span id="lstnumberx31.9" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx31.10" class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx32" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span id="lstnumberx32.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx32.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">func</span><span id="lstnumberx32.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span id="lstnumberx32.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx32.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx33" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span id="lstnumberx33.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span id="lstnumberx33.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">parameters</span><span id="lstnumberx33.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span id="lstnumberx33.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx33.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">["</span><span id="lstnumberx33.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">buffer</span><span id="lstnumberx33.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">",</span><span id="lstnumberx33.8" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx33.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">"</span><span id="lstnumberx33.10" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i32</span><span id="lstnumberx33.11" class="ltx_text ltx_font_typewriter" style="font-size:90%;">",</span><span id="lstnumberx33.12" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx33.13" class="ltx_text ltx_font_typewriter" style="font-size:90%;">"</span><span id="lstnumberx33.14" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i32</span><span id="lstnumberx33.15" class="ltx_text ltx_font_typewriter" style="font-size:90%;">"],</span>
</div>
<div id="lstnumberx34" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span id="lstnumberx34.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span id="lstnumberx34.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">result</span><span id="lstnumberx34.3" class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span id="lstnumberx34.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx34.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">"</span><span id="lstnumberx34.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i32</span><span id="lstnumberx34.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">",</span>
</div>
<div id="lstnumberx35" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span id="lstnumberx35.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx35.2" class="ltx_text ltx_font_typewriter" style="font-size:90%;">},</span>
</div>
<div id="lstnumberx36" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span id="lstnumberx36.1" class="ltx_text ltx_font_typewriter" style="font-size:90%;">});</span>
</div>
</div>
<figcaption class="ltx_caption" style="background-color:#FFFFFF;"><span class="ltx_tag ltx_tag_float">Listing 4: </span>example Deno.dlopen</figcaption>
</figure>
<div id="S4.p2" class="ltx_para">
<p id="S4.p2.1" class="ltx_p">Turbocall generates the following bindings:</p>
</div>
<figure id="LST5" class="ltx_float ltx_lstlisting">
<div id="LST5.1" class="ltx_listing ltx_lst_language_Assembly ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing" style="background-color:#FFFFFF;border-color: #000000;">
<div class="ltx_listing_data"><a href="data:text/plain;base64,LmFyY2ggYWFyY2g2NAoKbGRyIHgwLCBbeDEsICM4XSA7IGJ1ZmZlci0+ZGF0YQptb3YgeDEsIHgyICAgICAgIDsgYQptb3YgeDIsIHgzICAgICAgIDsgYgoKbW94eiB4OCwgMApiciB4OCAgICAgICAgICAgIDsgdGFpbGNhbGw=" download="">⬇</a></div>
<div id="lstnumberx37" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span id="lstnumberx37.1" class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span id="lstnumberx37.2" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">arch</span><span id="lstnumberx37.3" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx37.4" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">aarch64</span>
</div>
<div id="lstnumberx38" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span>
</div>
<div id="lstnumberx39" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span id="lstnumberx39.1" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ldr</span><span id="lstnumberx39.2" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx39.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">x0</span><span id="lstnumberx39.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx39.5" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx39.6" class="ltx_text ltx_font_typewriter" style="font-size:90%;">[</span><span id="lstnumberx39.7" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">x1</span><span id="lstnumberx39.8" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx39.9" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx39.10" class="ltx_text ltx_font_typewriter" style="font-size:90%;">#8]</span><span id="lstnumberx39.11" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx39.12" class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span><span id="lstnumberx39.13" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx39.14" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">buffer</span><span id="lstnumberx39.15" class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span id="lstnumberx39.16" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data</span>
</div>
<div id="lstnumberx40" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span id="lstnumberx40.1" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mov</span><span id="lstnumberx40.2" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx40.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">x1</span><span id="lstnumberx40.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx40.5" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx40.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">x2</span><span id="lstnumberx40.7" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">       </span><span id="lstnumberx40.8" class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span><span id="lstnumberx40.9" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx40.10" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">a</span>
</div>
<div id="lstnumberx41" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span id="lstnumberx41.1" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mov</span><span id="lstnumberx41.2" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx41.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">x2</span><span id="lstnumberx41.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx41.5" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx41.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">x3</span><span id="lstnumberx41.7" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">       </span><span id="lstnumberx41.8" class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span><span id="lstnumberx41.9" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx41.10" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">b</span>
</div>
<div id="lstnumberx42" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span>
</div>
<div id="lstnumberx43" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span id="lstnumberx43.1" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">moxz</span><span id="lstnumberx43.2" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx43.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">x8</span><span id="lstnumberx43.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx43.5" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx43.6" class="ltx_text ltx_font_typewriter" style="font-size:90%;">0</span>
</div>
<div id="lstnumberx44" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span id="lstnumberx44.1" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">br</span><span id="lstnumberx44.2" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx44.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">x8</span><span id="lstnumberx44.4" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span id="lstnumberx44.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span><span id="lstnumberx44.6" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx44.7" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">tailcall</span>
</div>
</div>
<figcaption class="ltx_caption" style="background-color:#FFFFFF;"><span class="ltx_tag ltx_tag_float">Listing 5: </span>example Turbocall assembly</figcaption>
</figure>
<div id="S4.p3" class="ltx_para">
<p id="S4.p3.1" class="ltx_p">This is simply ARM64 assembly for something like this in C:</p>
</div>
<figure id="LST6" class="ltx_float ltx_lstlisting">
<div id="LST6.1" class="ltx_listing ltx_lst_language_C ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing" style="background-color:#FFFFFF;border-color: #000000;">
<div class="ltx_listing_data"><a href="data:text/plain;base64,aW50IGZ1bmNfdHJhbXBvbGluZSh2b2lkKiBfdGhpcywgRmFzdEFwaVR5cGVkQXJyYXkqIGJ1ZmZlciwgaW50IGEsIGludCBiKSB7CiAgcmV0dXJuIGZ1bmMoYnVmZmVyLT5kYXRhLCBhLCBiKTsKfQ==" download="">⬇</a></div>
<div id="lstnumberx45" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span id="lstnumberx45.1" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx45.1.1" class="ltx_text" style="color:#0000FF;">int</span></span><span id="lstnumberx45.2" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx45.3" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">func_trampoline</span><span id="lstnumberx45.4" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx45.5" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx45.5.1" class="ltx_text" style="color:#0000FF;">void</span></span><span id="lstnumberx45.6" class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span id="lstnumberx45.7" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx45.8" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">_this</span><span id="lstnumberx45.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx45.10" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx45.11" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FastApiTypedArray</span><span id="lstnumberx45.12" class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span id="lstnumberx45.13" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx45.14" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">buffer</span><span id="lstnumberx45.15" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx45.16" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx45.17" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx45.17.1" class="ltx_text" style="color:#0000FF;">int</span></span><span id="lstnumberx45.18" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx45.19" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">a</span><span id="lstnumberx45.20" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx45.21" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx45.22" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx45.22.1" class="ltx_text" style="color:#0000FF;">int</span></span><span id="lstnumberx45.23" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx45.24" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">b</span><span id="lstnumberx45.25" class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span id="lstnumberx45.26" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx45.27" class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx46" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span id="lstnumberx46.1" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span id="lstnumberx46.2" class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span id="lstnumberx46.2.1" class="ltx_text" style="color:#0000FF;">return</span></span><span id="lstnumberx46.3" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx46.4" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">func</span><span id="lstnumberx46.5" class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span id="lstnumberx46.6" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">buffer</span><span id="lstnumberx46.7" class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span id="lstnumberx46.8" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data</span><span id="lstnumberx46.9" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx46.10" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx46.11" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">a</span><span id="lstnumberx46.12" class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span id="lstnumberx46.13" class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span id="lstnumberx46.14" class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">b</span><span id="lstnumberx46.15" class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx47" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span id="lstnumberx47.1" class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
</div>
<figcaption class="ltx_caption" style="background-color:#FFFFFF;"><span class="ltx_tag ltx_tag_float">Listing 6: </span>generated function trampoline</figcaption>
</figure>
<div id="S4.p4" class="ltx_para">
<p id="S4.p4.1" class="ltx_p">Most notably, it generates code to properly pass JS typed arrays and arguments to the native FFI symbol.</p>
</div>
<div id="S4.p5" class="ltx_para">
<p id="S4.p5.1" class="ltx_p">I gave a talk on this topic at the DenoFest Meetup in Tokyo<span id="footnote2" class="ltx_note ltx_role_footnote"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span><a href="https://www.youtube.com/watch?v=ssYN4rFWRIU" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://www.youtube.com/watch?v=ssYN4rFWRIU</a></span></span></span>
which goes into more detail about the implementation.</p>
</div>
</section>
<section id="S5" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Benchmarks</h2>

<div id="S5.p1" class="ltx_para">
<p id="S5.p1.1" class="ltx_p">This made FFI calls 100x faster in Deno: <a href="https://github.com/denoland/deno/pull/15125" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://github.com/denoland/deno/pull/15125</a></p>
</div>
<div id="S5.p2" class="ltx_para">
<p id="S5.p2.1" class="ltx_p">Let’s see how this compares against other runtimes.</p>
</div>
<figure id="S5.F1" class="ltx_figure ltx_align_floatleft"><img src="assets/deno.png" id="S5.F1.1.g1" class="ltx_graphics ltx_centering" alt="Refer to caption">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>Benchmark comparing Deno, Bun and Node.js on Sqlite and DuckDB</figcaption>
</figure>
<div id="S5.p3" class="ltx_para">
<p id="S5.p3.1" class="ltx_p">This is running sqlite3 and duckdb benchmarks on Deno, Bun and Node.js. See benchmark source. <span id="footnote3" class="ltx_note ltx_role_footnote"><sup class="ltx_note_mark">3</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">3</sup><span class="ltx_tag ltx_tag_note">3</span><a href="https://github.com/littledivy/blazing-fast-ffi-talk" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://github.com/littledivy/blazing-fast-ffi-talk</a></span></span></span></p>
</div>
</section>
<section id="S6" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Turbocall in action</h2>

<div id="S6.p1" class="ltx_para">
<p id="S6.p1.1" class="ltx_p">Slide from the DenoFest talk:</p>
</div>
<figure id="S6.F2" class="ltx_figure ltx_align_floatleft"><img src="assets/turbocall-slide.png" id="S6.F2.1.g1" class="ltx_graphics ltx_centering" alt="Refer to caption">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>Turbocall slide</figcaption>
</figure>
</section>
<section id="S7" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>Future</h2>

<div id="S7.p1" class="ltx_para">
<p id="S7.p1.1" class="ltx_p">It will be interesting to see how Static Hermes<span id="footnote4" class="ltx_note ltx_role_footnote"><sup class="ltx_note_mark">4</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">4</sup><span class="ltx_tag ltx_tag_note">4</span><a href="https://tmikov.blogspot.com/2023/09/how-to-speed-up-micro-benchmark-300x.html" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://tmikov.blogspot.com/2023/09/how-to-speed-up-micro-benchmark-300x.html</a></span></span></span> will compare against
V8 fast calls. Both can probably generate similar code at runtime but implemented very differently.</p>
</div>
<div id="S7.p2" class="ltx_para">
<p id="S7.p2.1" class="ltx_p">I’m also excited about ‘just-js/lo‘<span id="footnote5" class="ltx_note ltx_role_footnote"><sup class="ltx_note_mark">5</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">5</sup><span class="ltx_tag ltx_tag_note">5</span><a href="https://github.com/just-js/lo" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://github.com/just-js/lo</a></span></span></span> which is a WIP low-level JS runtime that
aims to generate V8 fast calls bindings ahead-of-time (similar to Deno) but also allow for
a more engine-agnostic design where you could swap out V8 for other engines like Hermes, Quickjs.</p>
</div>
<div id="S7.p3" class="ltx_para">
<p id="S7.p3.1" class="ltx_p">That’s it! Feel free to follow me on Twitter: <a href="https://twitter.com/undefined_void" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://twitter.com/undefined_void</a></p>
</div>
<div id="S7.p4" class="ltx_para">
<p id="S7.p4.1" class="ltx_p">This document is available as PDF: <a href="https://divy.work/pdf/turbocall.pdf" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://divy.work/pdf/turbocall.pdf</a></p>
</div>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Sun Jun  9 15:20:44 2024 by <a href="http://dlmf.nist.gov/LaTeXML/" class="ltx_LaTeXML_logo"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="Mascot Sammy"></a>
</div></footer>
</div>
</body>
</html>
